# Config for Circle.CI

# TODO: fix - now built with Python 2.7.9; 2.7.6/8 crashes at 'python setup.py install'

machine:
  timezone:
    Europe/Warsaw
  python:
    version: 2.7.11

dependencies:
  post:
    - rm -r ~/.gradle
    - python setup.py test --dry-run
    - pip install -r requirements-dev-base.txt --upgrade
    - pip install -r requirements-dev.txt --upgrade
    # TODO how to manage difference between deps possibly different for dev and non-dev envs?
   
test:
  pre:
  - virtualenv -p ~/.pyenv/versions/2.7.11/bin/python2.7 venv27 --distribute
  - source venv27/bin/activate ; pip install -r requirements-dev-base.txt --upgrade ; pip install -r requirements-dev.txt --upgrade ; pip freeze ; python2.7 setup.py install 
  override:
  - source venv27/bin/activate ; tox ; python -B manage.py alltests ; nosetests tests ; coverage run setup.py test
  post:
  - bash <(curl -s https://codecov.io/bash)
# *** need to provide  repo_token in .coveralls.yml, or launch via Travis
#  post:
#  - coverage combine
#  - coveralls 

#deployment:
#  staging:
#    branch: master
#    heroku:
#      appname: ---
